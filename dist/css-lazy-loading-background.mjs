"undefined"==typeof globalThis&&(Object.defineProperty(Object.prototype,"__magic__",{configurable:!0,get:function(){return this}}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__);class CommonUtilities{static isHostMethod(e,t){if(!e)return!1;const r=typeof e[t];return this.reUnknown.test(r)||this.reMethod.test(r)&&Boolean(e)||!1}}CommonUtilities.reMethod=/^(function|object)$/,CommonUtilities.reUnknown=/^unknown$/;class CssLazyLoadingBackground{constructor(){this.lazyBackgroundObserver=null,this.isIntersectionObserverSupported=CommonUtilities.isHostMethod(globalThis,"IntersectionObserver"),this.processEntriesBindInstance=null,this.skipElements=`${[":root","base","body","br","code","defs","desc","filter","g","head","hgroup","hr","iframe","img","input","linearGradient","link","mark","meta","noscript","object","option","path","script","stop","style","title"].map((e=>`:not(${e})`)).join("")}`}loadBackgroundIfElementOnScreen(e){if(!1===e.isIntersecting)return;const t=e.target,r=globalThis.getComputedStyle(t).getPropertyValue("--background-image-lazy");if(r.length>0)return t.style.setProperty("background-image",`url('${r.replace(/(?:\\(.))/g,"$1").trim()}')`),t.style.removeProperty("--background-image-lazy"),void this.lazyBackgroundObserver.unobserve(t);const o=globalThis.getComputedStyle(t).getPropertyValue("--background-image-set-lazy");if(o.length>0){const e=o.replace("image-lazy-set","image-set");return void t.style.setProperty("background-image",e)}const n=t.getAttribute("data-lazy-background");"string"==typeof n&&n.length>0&&(t.style.setProperty("background-image",`url('${n}')`),t.removeAttribute("data-lazy-background"),this.lazyBackgroundObserver.unobserve(t))}processEntries(e){for(const t of e)this.loadBackgroundIfElementOnScreen(t)}observeElementVisibility(e){this.lazyBackgroundObserver.observe(e)}setBackground(e){const t=globalThis.getComputedStyle(e).getPropertyValue("--background-image-lazy");if(t.length>0)return e.style.setProperty("background-image",`url('${t.replace(/(?:\\(.))/g,"$1").trim()}')`),void e.style.removeProperty("--background-image-lazy");const r=globalThis.getComputedStyle(e).getPropertyValue("--background-image-set-lazy");if(r.length>0){const t=r.replace("image-lazy-set","image-set");e.style.setProperty("background-image",t),e.style.removeProperty("--background-image-set-lazy")}}getLazyBackgroundDetail(e){const t=globalThis.getComputedStyle(e).getPropertyValue("--background-image-lazy"),r=globalThis.getComputedStyle(e).getPropertyValue("--background-image-set-lazy"),o=e.getAttribute("data-lazy-background");return t.length>0||r.length>0||"string"==typeof o&&o.length>0}initialiseStyleBackgroundIntersectionObserver(){const e=Array.from(document.querySelectorAll(`body *${this.skipElements}`));if(0===e.length)return;const t=e.filter(this.getLazyBackgroundDetail);if(0!==t.length)if(this.isIntersectionObserverSupported){this.processEntriesBindInstance=this.processEntries.bind(this),this.lazyBackgroundObserver=new IntersectionObserver(this.processEntriesBindInstance);for(const e of t)this.observeElementVisibility(e)}else for(const e of t)this.setBackground(e)}destroy(){this.processEntriesBindInstance=null}initialise(){"string"==typeof document.readyState&&"loading"!==document.readyState?this.initialiseStyleBackgroundIntersectionObserver():window.addEventListener("DOMContentLoaded",this.initialiseStyleBackgroundIntersectionObserver,!0)}}export{CssLazyLoadingBackground};
